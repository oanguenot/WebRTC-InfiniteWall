{"version":3,"file":"public\\javascripts\\app.js","sources":["app/application.js","app/initialize.js","app/lib/me.js","app/lib/media.js","app/lib/router.js","app/lib/view_helper.js","app/models/collection.js","app/models/conference.js","app/models/im.js","app/models/message.js","app/models/model.js","app/models/participant.js","app/server/config.js","app/server/connection.js","app/server/dbManager.js","app/server/router.js","app/views/home_view.js","app/views/local.js","app/views/main_view.js","app/views/message.js","app/views/participant.js","app/views/stage.js","app/views/templates/home.hbs","app/views/templates/local.hbs","app/views/templates/main.hbs","app/views/templates/message.hbs","app/views/templates/participant.hbs","app/views/templates/stage.hbs","app/views/view.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxGA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnIA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjDA;;A,CCAA;;AACA;AADA;;A,CCAA;;AACA;AACA;AACA;AACA;AAJA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AACA;AAJA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AACA;AAJA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1BA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3PA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9KA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzNA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzDA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1BA;;A","sourcesContent":["// Application bootstrapper.\nApplication = {\n    initialize: function() {\n        \n        var HomeView = require('views/home_view'),\n        \tMainView = require('views/main_view'),\n        \tRouter   = require('lib/router');\n\n        this.homeView = new HomeView();\n        this.mainView = new MainView();\n        this.router   = new Router();\n        \n        if (typeof Object.freeze === 'function') Object.freeze(this)\n        \n    },\n\n\troute: function(route) {\n\t    this.router.navigate(route, {trigger:true});\n\t}\n}\n\nmodule.exports = Application;\n","var application = require('application')\n\n$(function() {\n    application.initialize()\n    Backbone.history.start()\n})\n","var Participant = require('../models/participant'),\r\n\tConference = require('../models/conference');\r\n\r\nvar me = new Participant(),\r\n\tconference = new Conference();\r\n\r\nvar _mode = \"connivence\";\r\n\r\nme.on('change', function(model) {\r\n\tBackbone.Mediator.publish('me:changed', model);\r\n});\r\n\r\nmodule.exports = {\r\n\t\r\n\tsetInfo: function(nickname, hasAudio, hasVideo) {\r\n\t\tme.set({hasAudio: hasAudio, hasVideo: hasVideo, nickname: nickname});\r\n\t},\r\n\r\n\tsetConference: function(info) {\r\n\t\tconference.set({title: info.conferenceTitle, room: info.conferenceCode});\r\n\t},\r\n\r\n\tgetConference: function() {\r\n\t\treturn conference;\r\n\t},\r\n\r\n\tgetConferenceTitle: function() {\r\n\t\treturn conference.get('title');\r\n\t},\r\n\r\n\tgetConferenceCode: function() {\r\n\t\treturn conference.get('room');\r\n\t},\r\n\r\n\tsetId: function(id) {\r\n\t\tme.set({id: id});\r\n\t},\r\n\r\n\tnickname: function() {\r\n\t\treturn me.get('nickname');\r\n\t},\r\n\r\n\thasAudio: function() {\r\n\t\treturn me.get('hasAudio');\r\n\t},\r\n\r\n\thasVideo: function() {\r\n\t\treturn me.get('hasVideo');\r\n\t},\r\n\r\n\tshouldCreateNewConference: function() {\r\n\t\treturn (conference.get('room').length === 0 ? true : false);\r\n\t},\r\n\r\n\tsetMode: function(mode) {\r\n\t\t_mode = mode;\r\n\t},\r\n\r\n\tgetMode: function() {\r\n\t\treturn _mode;\r\n\t},\r\n\r\n\tcreateNewConference: function() {\r\n\t\t$.ajax({\r\n\t\t\turl: \"/conference\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: {\r\n\t\t\t\ttitle: conference.get('title')\r\n\t\t\t}\r\n\t\t}).done(function ( data ) {\r\n\t\t\tconference.set(data);\r\n\t\t}).fail(function ( data ) {\r\n\t\t\tconsole.log(\"ERROR:\", data);\r\n\t\t});\r\n\t},\r\n\r\n\tjoinExistingConference: function(code) {\r\n\t\t$.ajax({\r\n\t\t\turl: \"/conference/\" + code,\r\n\t\t\ttype: \"GET\",\r\n\t\t}).done(function ( data ) {\r\n\t\t\tconference.set({'id': data.id, 'title': data.title});\r\n\t\t}).fail(function ( data ) {\r\n\t\t\tconsole.log(\"ERROR:\", data);\r\n\t\t});\r\n\t},\r\n\r\n\tcreateOrJoinConferenceByID: function(roomID, conferenceName) {\r\n\t\t$.ajax({\r\n\t\t\turl: \"/conference/\" + roomID,\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdata: {\r\n\t\t\t\ttitle: conferenceName\r\n\t\t\t}\r\n\t\t}).done(function ( data ) {\r\n\t\t\tconsole.log(\"coucou\");\r\n\t\t\tconference.set(data);\r\n\t\t}).fail(function ( data ) {\r\n\t\t\tconsole.log(\"ERROR:\", data);\r\n\t\t});\r\n\t}\r\n\r\n};\r\n\r\n","Sonotone.debug = true;\r\nSonotone.enableSTUN = true;\r\n\r\n/*\r\nSonotone.STUN = {\r\n    iceServers: [\r\n\t\t{\r\n    \t\turl: \"stun:stun.l.google.com:19302\"\r\n    \t}, \r\n    \t{\r\n            url: \"turn:numb.viagenie.ca\", credential: \"oanguenot\", username: \"oanguenot%40gmail.com\"\r\n        }\r\n    ]\r\n};\r\n*/\r\n\r\nvar io = null;\r\n\r\nvar sono = new Sonotone.IO(new Date().getTime());\r\n\r\nsono.localMedia().on('onLocalVideoStreamStarted', function onLocalStreamStarted(stream) {\r\n\tBackbone.Mediator.publish('media:localStreamStarted', stream, Sonotone.ID);\r\n}, this);\r\n\r\nsono.localMedia().on('onLocalVideoStreamEnded', function onLocalStreamEnded() {\r\n\r\n}, this);\r\n\r\nsono.localMedia().on('onLocalVideoStreamError', function onLocalStreamError() {\r\n\r\n}, this);\r\n\r\nsono.remoteMedia().on('onRemoteStreamStarted', function onRemoteStreamStarted(id) {\r\n\tBackbone.Mediator.publish('media:remoteVideoON', id);\r\n}, this);\r\n\r\nsono.remoteMedia().on('onRemoteStreamEnded', function onRemoteStreamEnded(id) {\r\n\tBackbone.Mediator.publish('media:remoteVideoOFF', id);\r\n}, this);\r\n\r\nsono.on('onPeerConnected', function onPeerConnected(data) {\r\n\tBackbone.Mediator.publish('media:participantConnected', data.id, data.caps);\r\n}, this);\r\n\r\nsono.on('onPeerDisconnected', function onPeerDisconnected(id) {\r\n\tBackbone.Mediator.publish('media:participantDisconnected', id);\r\n}, this);\r\n\r\nsono.on('onPeerChat', function onPeerChat(data) {\r\n\tBackbone.Mediator.publish('media:participantMessage', data.id, data.content);\r\n}, this);\r\n\r\nsono.on('onPeerAlreadyConnected', function onPeerAlreadyConnected(data){\r\n\tBackbone.Mediator.publish('media:participantAlreadyConnected', data.id, data.caps);\r\n}, this);\r\n\r\nsono.on('onCallOffered', function onCallOffered(id){\r\n\tBackbone.Mediator.publish('media:onCallOffered', id);\r\n}, this);\r\n\r\nsono.on('onCallAnswered', function onCallAnswered(id){\r\n\tBackbone.Mediator.publish('media:onCallAnswered', id);\r\n}, this);\r\n\r\nmodule.exports = {\r\n\r\n\tacquireCamera: function(withAudio, withVideo) {\r\n\t\tvar constraints = {\r\n            audio: withAudio,\r\n            video: withVideo,\r\n            format: 'qvga'\r\n        };\r\n\r\n        sono.localMedia().acquire(constraints);\r\n\t},\r\n\r\n\tacquireScreen: function() {\r\n\t\tsono.localMedia().acquireScreen();\r\n\t},\r\n\r\n\trenderLocalStream: function(HTMLElement) {\r\n\t\tsono.localMedia().renderVideoStream(HTMLElement);\r\n\t},\r\n\r\n\tconnectToServer: function(caps, room) {\r\n\r\n\t\tsono.transport('websocket', {host: window.location.hostname, port: null});\r\n\r\n\t\tsono.transport().on('onReady', function onReady() {\r\n\r\n\t\t}, this);\r\n\r\n\t\tsono.transport().on('onClose', function onClose() {\r\n\r\n\t\t}, this);\r\n\r\n\t\tsono.transport().on('onError', function onError() {\r\n\r\n\t\t}, this)\r\n\r\n\t\tsono.transport().connect(caps, room);\r\n\t},\r\n\r\n\tcallParticipant: function(id, hasRemoteDataChannel) {\r\n\t\tsono.call(id, hasRemoteDataChannel);\r\n\t},\r\n\r\n\tanswerParticipant: function(id, hasRemoteDataChannel) {\r\n\t\tsono.answer(id, hasRemoteDataChannel);\r\n\t},\r\n\r\n\tdisplayParticipantVideo: function(HTMLElement, id) {\r\n\t\tsono.remoteMedia().renderStream(HTMLElement, id);\r\n\t},\r\n\r\n\tsendMessage: function(message) {\r\n\t\tsono.sendChatMessage(message);\r\n\t},\r\n\r\n\tsendData: function(msg, callee) {\r\n\t\tsono.sendMessageUsingChannel(msg, callee);\r\n\t},\r\n\r\n\tgetCapabilities: function() {\r\n\t\treturn sono.capabilities();\r\n\t},\r\n\r\n\tisMe: function(id) {\r\n\t\treturn (id === sono.ID ? true: false);\r\n\t}\r\n\r\n};","var application = require('application'),\n    me = require('./me');\n\n\nfunction getQueryParams(qs) {\n    qs = qs.split(\"+\").join(\" \");\n\n    var params = {}, tokens = true, re = /[?&]?([^=]+)=([^&]*)/g;\n\n    while (tokens) {\n        tokens = re.exec(qs);\n        if (tokens) {\n            params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n        }\n    }\n\n    return params;\n};\n\nBackbone.Mediator.subscribe('goto', function(route) {\n    application.route(route);\n});\n\nmodule.exports = Backbone.Router.extend({\n    routes: {\n        '': 'home',\n        'join?:querystring': 'onParticipantJoin',\n        'mainPage': 'mainPage'\n    },\n    \n    home: function() {\n        $('body').html(application.homeView.render().el);\n    },\n\n    mainPage: function() {\n    \t$('body').html(application.mainView.render().el);\n    },\n\n    onParticipantJoin: function() {\n        var url = window.location.hash.substr(5);\n\n        params = getQueryParams(url);\n\n        $('body').html(application.homeView.render().el);\n\n        application.homeView.setRoom(params.room);\n        \n    }\n});\n","// Put handlebars.js helpers here\n","// Base class for all collections\nmodule.exports = Backbone.Collection.extend({\n    \n})\n","module.exports = Backbone.Model.extend({\r\n    \r\n\tdefaults: {\r\n        id: '',\r\n        room: '',\r\n        title: ''\r\n    },\r\n\r\n    initialize: function(){\r\n    }\r\n\r\n});","var Message = require('./message');\r\n\r\nmodule.exports = Backbone.Collection.extend({\r\n\tmodel: Message\r\n});","module.exports = Backbone.Model.extend({\r\n    \r\n\tdefaults: {\r\n        time: new Date(),\r\n        issuer: '',\r\n        content: ''\r\n    },\r\n\r\n    initialize: function(){\r\n    }\r\n\r\n});","// Base class for all models\nmodule.exports = Backbone.Model.extend({\n    \n})\n","module.exports = Backbone.Model.extend({\r\n    \r\n\tdefaults: {\r\n        id: '',\r\n        hasAudio: false,\r\n        hasvideo: false,\r\n        nickname: '',\r\n        size:'participant',\r\n        date: new Date(),\r\n    },\r\n\r\n    initialize: function(){\r\n    }\r\n\r\n});","//var dbHost= 'mongo.onmodulus.net';\r\n//var dbName= 'patuP8at';\r\n//var dbUser= 'crock';\r\n//var dbPass= 'crock';\r\n\r\nvar dbConfig = {\r\n    dbUser      : 'crock',\r\n    dbPass      : 'crock',\r\n    dbPort      : 27017,\r\n    dbHost      : 'mongo.onmodulus.net',\r\n    dbName      : 'patuP8at'\r\n};\r\n/*\r\nvar dbConfig = {\r\n    dbUser      : \"\",\r\n    dbPass      : \"\",\r\n    dbPort      : 27017,\r\n    dbHost      : 'localhost',\r\n    dbName      : 'connivence'\r\n};\r\n*/\r\n\r\nexports.cfg = function() {\r\n    return dbConfig;\r\n};\r\n\r\n","\r\nconsole.log (\"[CONNECTION::Start\");\r\n\r\n//var io = require('socket.io'); \r\nvar sockets = null;\r\nvar connections = [];\r\n\r\nvar connected = [];\r\n\r\nvar conferences = {};\r\n\r\nvar _getConferenceByRoom = function _getConferenceByRoom(code) {\r\n\t\r\n\tif(code in conferences){\r\n\t\treturn {\r\n\t\t\ttitle : conferences[code].title,\r\n\t\t\tid: conferences[code].id,\r\n\t\t\troom: conferences[code].room\r\n\t\t};\r\n\t}\r\n\telse {\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nvar _addNewConference = function _addNewConference(title) {\r\n\r\n\tvar conference = {\r\n\t\ttitle : title,\r\n\t\tid: new Date().getTime(),\r\n\t\troom: Math.floor(Math.random() * 1000) + '-' + Math.floor(Math.random() * 1000)\r\n\t}\r\n\r\n\tconsole.log(\"[CONNECTION::Add new room:\" + conference.room + \" | \" + conference.title);\r\n\r\n\tconferences[conference.room] = {\r\n\t\tconnections : [],\r\n\t\ttitle: conference.title,\r\n\t\tid: conference.id,\r\n\t\troom: conference.room\r\n\t};\r\n\r\n\treturn conference;\r\n};\r\n\r\nvar _createOrJoinConference = function _createOrJoinConference(title, roomID) {\r\n\r\n\tif( roomID in conferences) {\r\n\t\t\r\n\t\treturn {\r\n\t\t\ttitle : conferences[roomID].title,\r\n\t\t\tid: conferences[roomID].id,\r\n\t\t\troom: conferences[roomID].room\r\n\t\t};\r\n\t}\r\n\telse {\r\n\r\n\t\tvar conference = {\r\n\t\t\ttitle : title,\r\n\t\t\tid: new Date().getTime(),\r\n\t\t\troom: roomID\r\n\t\t};\r\n\r\n\t\tconferences[conference.room] = {\r\n\t\t\tconnections : [],\r\n\t\t\ttitle: conference.title,\r\n\t\t\tid: conference.id,\r\n\t\t\troom: conference.room\r\n\t\t};\r\n\r\n\t\treturn conference;\r\n\t}\r\n}\r\n\r\nvar _startServer = function _startServer(wsServer) {\r\n\r\n\twsServer.on('request', function(request) {\r\n\t\tvar connection = request.accept(null, request.origin);\r\n\r\n\t\t//connections.push({id: '', socket: connection});\r\n\r\n    \t//console.log(\"New peer connected\");\r\n\r\n    \t// This is the most important callback for us, we'll handle\r\n    \t// all messages from users here.\r\n    \tconnection.on('message', function(evt) {\r\n        \t\r\n        \tif (evt.type === 'utf8') {\r\n\t\t\r\n        \t\tvar msg = JSON.parse(evt.utf8Data);\r\n            \r\n            \tvar caller = msg.caller;\r\n            \tvar room = msg.room;\r\n            \tvar currentRoom = conferences[room];\r\n\r\n            \t//console.log(\"RECEIVED from <\" + caller + \">:\" + evt.utf8Data);\r\n\r\n\t            if(msg.data.type === \"join\") {\r\n\r\n\t            \t// Assign the socket to the correct room\r\n\t            \t// Todo remove the connection from this temp array\r\n\t            \t//for (var i=0;i<connections.length;i++) {\r\n\t            \t\t//if(connections[i].socket === connection) {\r\n\t            \t\t\tconferences[room].connections.push({id: caller, socket: connection, caps: msg.data.caps});\r\n\t            \t\t\tconsole.log(\"<\"+ caller + \"> has entered room <\"+ room + \">\");\r\n\t            \t\t\t//connections[i] = null;\r\n\t            \t\t\t//delete connections[i];\r\n\t            \t\t\tconsole.log(\"store in connected:\" + room);\r\n\t            \t\t\tconnected.push({socket: connection, room: room, id: caller});\r\n\t            \t\t\t//break;\r\n\t            \t\t//}\r\n\t            \t//}\r\n\r\n\t            \t// Alert others peers\r\n\t                for (var i=0;i<currentRoom.connections.length;i++) {\r\n\t                    // Associate Socket <-> ID\r\n\t                    if(currentRoom.connections[i].socket === connection) {\r\n\t                        /*\r\n\t                        //console.log(\"old id:\" + connections[i].id);\r\n\t                        connections[i].id = caller;\r\n\t                        //store capabilities\r\n\t                        connections[i].caps = msg.data.caps;\r\n\t                        console.log(\"<\"+ caller + \"> has been associated to a socket\");\r\n\t                        */\r\n\t                    }\r\n\t                    // Send information about other peer connected\r\n\t                    else {\r\n\t                        console.log(\"Inform <\" + currentRoom.connections[i].id + \"> about new peer <\" + caller + \">\");\r\n\t                        currentRoom.connections[i].socket.send(evt.utf8Data);\r\n\r\n\t                        console.log(\"Inform <\" + caller + \"> about connected <\" + currentRoom.connections[i].id + \">\");\r\n\r\n\t                        // Send to this peer all others connections\r\n\t                        var msg = {\r\n\t                            data: {\r\n\t                                type: 'already_joined',\r\n\t                                caps: currentRoom.connections[i].caps\r\n\t                            },\r\n\t                            callee: caller,\r\n\t                            caller: currentRoom.connections[i].id\r\n\t                        };\r\n\r\n\t                        connection.send(JSON.stringify(msg));\r\n\t                    }\r\n\t                }\r\n\r\n\t            } else {\r\n\t            \t// Send a message to only one peer\r\n\t            \tif(msg.callee !== \"all\") {\r\n\t                    for (var i = 0;i < currentRoom.connections.length; i++) {\r\n\t                        //console.log(\"Connections:\" + connections[i].id);\r\n\t                        if(currentRoom.connections[i].id === msg.callee) {\r\n\t                            console.log(\"Send message <\" + msg.data.type + \"> to <\" + currentRoom.connections[i].id + \"> in room <\" + room + \">\");\r\n\t                            currentRoom.connections[i].socket.send(evt.utf8Data);\r\n\t                        }\r\n\t                     }\r\n\t                }\r\n\t                // Send a message to all peer\r\n\t                else {\r\n\t                    for (var i = 0;i < currentRoom.connections.length; i++) {\r\n\t                        // Except me\r\n\t                        if(currentRoom.connections[i].socket !== connection) {\r\n\t                            console.log(\"Send message <\" + msg.data.type + \"> to <\" + currentRoom.connections[i].id + \"> in room <\" + room + \">\");\r\n\t                            currentRoom.connections[i].socket.send(evt.utf8Data);\r\n\t                        }\r\n\t                        else {\r\n\t                        \tif(msg.data.type === \"chat\") {\r\n\t                        \t\tconsole.log(\"Send message <\" + msg.data.type + \"> back to <\" + currentRoom.connections[i].id + \"> (me) in room <\" + room + \">\");\r\n\t                        \t\tcurrentRoom.connections[i].socket.send(evt.utf8Data);\r\n\t                        \t}\r\n\t                        }\r\n\t                    }\r\n\t                }\r\n            \t}\r\n            }\r\n        \telse {\r\n          \t\t//console.log(\"RECEIVED OTHER:\" + evt.binaryData);\r\n        \t}\t\r\n\t\t});\r\n\r\n\t\t// TODO: A adapter pour supprimer la connection dans la bonne room!!!!!\r\n\t\tconnection.on('close', function() {\r\n\t\t\tconsole.log(\"bye bye peer\");\r\n\r\n\t\t\tvar index = -1;\r\n\t\t\tvar room = '';\r\n\r\n\t        for (var i = 0;i < connected.length; i++) {\r\n\t            if(connected[i].socket === connection) {\r\n\t                index = i;\r\n\t               room = connected[i].room;\r\n\t            }\r\n\t        }\r\n\r\n\t        if(index > -1) {\r\n\t            console.log(\"remove item:\" + index);\r\n\t            var old = connected.splice(index, 1);\r\n\r\n\t            var conference = conferences[room];\r\n\r\n\t            var index = -1;\r\n\r\n\t            //Inform others peers that are in the same conference about the disconnection\r\n\t            for (var i = 0; i < conference.connections.length; i++) {\r\n\t                if(conference.connections[i].socket !== connection) {\r\n\r\n\t                    var toSend = {\r\n\t                        data: {\r\n\t                            type:'release'\r\n\t                        },\r\n\t                        callee: 'all',\r\n\t                        caller:old[0].id\r\n\t                    };\r\n\t                    conference.connections[i].socket.send(JSON.stringify(toSend));\r\n\t                }\r\n\t                else {\r\n\t                \tindex = i;\r\n\t                }\r\n\t            }\r\n\r\n\t            // Remove from the room\r\n\t            conference.connections.splice(index, 1);\r\n\t        }\r\n\t\t});\r\n\r\n\t});\r\n\r\n\twsServer.on('close', function(request) {\r\n\r\n\r\n\t});\r\n\t\r\n\r\n};\r\n\r\nexports.startWebSocketServer = function(server) {\r\n\t_startServer(server);\r\n};\r\n\r\nexports.addNewConference = function(title) {\r\n\treturn (_addNewConference(title));\r\n};\r\n\r\nexports.getConferenceByRoom = function(code) {\r\n\treturn (_getConferenceByRoom(code));\r\n};\r\n\r\nexports.createOrJoinConference = function(title, code) {\r\n\treturn (_createOrJoinConference(title, code));\r\n}\r\n\r\n","var crypto       = require('crypto');\r\nvar MongoDB      = require('mongodb').Db;\r\nvar Server       = require('mongodb').Server;\r\nvar ObjectID     = require('mongodb').ObjectID;\r\n//var moment       = require('moment');\r\n\r\nvar config       = require('./config');\r\n\r\nconsole.log (\"[DB-MANAGER]::Start\");\r\n\r\nvar db = new MongoDB(config.cfg().dbName, new Server(config.cfg().dbHost, config.cfg().dbPort, {auto_reconnect: true}), {w: 1});\r\n    db.open(function(e, d){\r\n    if (e) {\r\n        console.log(e);\r\n    }   else{\r\n        console.log('connected to database :: ' + config.cfg().dbName);\r\n\r\n        if(config.cfg().dbUser.length > 0) {\r\n            db.authenticate(config.cfg().dbUser, config.cfg().dbPass, function(e, d){\r\n                if(e) {\r\n                    console.log('Error using :: ' + config.cfg().dbUser);\r\n                    console.log(e);\r\n                }\r\n                else {\r\n                    console.log('logged with :: ' + config.cfg().dbUser);\r\n                }\r\n            });\r\n        }\r\n    }\r\n});\r\n\r\n/*\r\nvar accounts = db.collection('accounts'),\r\n    topics = db.collection('topics'),\r\n    notes = db.collection('notes'),\r\n    subscriptions = db.collection('subscriptions');\r\n*/\r\n/* ---------------------------------------------------------- Account part ------------------------------------------*/\r\n\r\n\r\n","//var db = require('./dbManager'),\r\nvar cnx = require('./connection');\r\n\r\nmodule.exports = function(server, app) {\r\n\r\n    console.log (\"[SERVER-ROUTER]::Start\");\r\n    cnx.startWebSocketServer(server);\r\n\r\n\r\n    /* REST API */\r\n\r\n    app.post('/conference', function(req, res){\r\n        console.log(\"[SERVER-ROUTER]:: Create a new room \" +  req.param('title'));\r\n\r\n        var conf = cnx.addNewConference(req.param('title'));\r\n\r\n        res.send(conf, 201);\r\n    });\r\n\r\n    // FOR PINGME\r\n    app.post('/conference/:code', function(req, res){\r\n        console.log(\"[SERVER-ROUTER]:: Create or join new room for PINGME \" +  req.param('code'));\r\n\r\n        var conference = cnx.createOrJoinConference(req.param('title'), req.param('code'));\r\n\r\n        res.send(conference, 200);\r\n    });\r\n\r\n\tapp.get('/conference/:code', function(req, res){\r\n\r\n\t\tvar code = req.param('code');\r\n\r\n        console.log(\"[SERVER-ROUTER]:: Get information on existing room \" + code );\r\n        \r\n        var conference = cnx.getConferenceByRoom(code)\r\n\r\n        if(conference) {\r\n        \tres.send(conference, 200);\r\n        }\r\n        else {\r\n        \tres.send(\"not-found\", 404);\r\n        }\r\n    });\r\n\r\n};\r\n","var View     = require('./view'),\n  \ttemplate = require('./templates/home'),\n    me = require('../lib/me');\n\nvar isNicknameReady = false,\n    nickname = '';\n\nvar isConferenceNameReady = false,\n    conferenceTitle = '';\n\nvar isConferenceCodeReady = false,\n    conferenceCode = '';\n\nvar selectedCapability = \"full\";\n\nmodule.exports = View.extend({\n\n    id: 'home-view',\n    template: template,\n\n    events: {\n        'keyup #inputNickname'      : 'onNicknameChanged',\n        'keyup #inputCode'          : 'onCodeChanged',\n        'keyup #inputTitle'         : 'onTitleChanged',\n\n        'click .capabilitySelector' : 'onCapabilityChange',\n        'click .filterCapability'   : 'onCapabilityClick',\n\n        'click #joinExistingButton' : 'onJoinExistingConference',\n        'click #joinNewButton'      : 'onJoinNewConference'\n    },\n\n/*\n    subscriptions: {\n        'media:localStreamStarted': 'onLocalMediaStarted'\n    },\n*/\n\n    initialize: function() {\n        this.listenTo(me.getConference(), 'change:id', this.onConferenceIDChange);\n    },\n\n    afterRender: function(){\n    \t//media.acquireCamera();\n    },\n\n/*\n    onLocalMediaStarted: function(stream) {\n    \tmedia.renderStream(this.$('#local-video')[0]);\n        isMediaReady = true;\n        this.updateJoinButton();\n    },\n*/\n\n    onJoinRequest: function(e) {\n        e.preventDefault();\n        \n        \n    },\n\n    onNicknameChanged: function() {\n        nickname = this.$('#inputNickname').val();\n\n        if(nickname.length > 0) {\n            isNicknameReady = true;\n        }\n        else {\n            isNicknameReady = false;\n        }\n        this.updateJoinButton();\n    },\n\n    onCodeChanged: function() {\n        conferenceCode = this.$('#inputCode').val();\n\n         if(conferenceCode.length > 0) {\n            isConferenceCodeReady = true;\n        }\n        else {\n            isConferenceCodeReady = false;\n        }\n        this.updateJoinButton();\n    },\n\n    onTitleChanged: function() {\n        conferenceTitle= this.$('#inputTitle').val();\n\n         if(conferenceTitle.length > 0) {\n            isConferenceNameReady = true;\n        }\n        else {\n            isConferenceNameReady = false;\n        }\n        this.updateJoinButton();\n    },\n\n    updateJoinButton: function() {\n        if(isNicknameReady && isConferenceNameReady) {\n            this.$('#joinNewButton').removeAttr(\"disabled\");\n        }\n        else {\n            this.$('#joinNewButton').attr(\"disabled\", \"disabled\");\n        }\n\n        if(isNicknameReady && isConferenceCodeReady) {\n            this.$('#joinExistingButton').removeAttr(\"disabled\");\n        }\n        else {\n            this.$('#joinExistingButton').attr(\"disabled\", \"disabled\");\n        }\n\n    },\n\n    onCapabilityChange: function(e) {\n        e.preventDefault();\n\n        this.$('.l-' + selectedCapability).removeClass('selected');\n\n        selectedCapability = e.currentTarget.attributes[1].nodeValue;\n        this.$('.l-' + selectedCapability).addClass('selected');\n        var text = this.$('.' + selectedCapability).attr('data-text');\n\n        this.$('.selectedCapability').text(text);\n        this.$('.selectedCapability').attr('data-capabilities', selectedCapability);\n    },\n\n    onCapabilityClick: function(e) {\n        e.preventDefault();\n    },\n\n    onJoinExistingConference: function(e) {\n        e.preventDefault();\n        this.goToConference(true);\n        \n    },\n\n    onJoinNewConference: function(e) {\n        e.preventDefault();\n        this.goToConference(false);\n    },\n\n    goToConference: function(existingConference) {\n        var hasAudio = (selectedCapability === 'full' || selectedCapability === 'audio');\n        var hasVideo = (selectedCapability === 'full' || selectedCapability === 'video');\n\n        var conferenceInfo = {\n            isNewConference: !existingConference,\n            conferenceCode: existingConference ? conferenceCode : '',\n            conferenceTitle: existingConference ? '' : conferenceTitle\n        };\n\n        me.setInfo(nickname, hasAudio, hasVideo);\n        me.setConference(conferenceInfo);\n\n        if(existingConference) {\n            me.joinExistingConference(me.getConferenceCode());\n        }\n        else {\n            me.createNewConference(me.getConferenceTitle());\n        }\n\n    },\n\n    onConferenceIDChange: function() {\n        Backbone.Mediator.publish('goto', 'mainPage');\n    },\n\n    setRoom: function(room) {\n        this.$('#inputCode').val(room);\n        this.$('#inputTitle').prop('disabled', true);\n        isConferenceCodeReady = true;\n        conferenceCode = room;\n    }\n});\n","var View     = require('./view');\r\n\r\nvar timeoutID = -1;\r\n\r\nmodule.exports = View.extend({\r\n\r\n\tclassName: \"participant\",\r\n\r\n\ttemplate: require('./templates/local'),\r\n\r\n    local: null,\r\n\r\n\tevents: {\r\n\t},\r\n\r\n\tsubscriptions: {\r\n\r\n    },\r\n\r\n    initialize: function(options) {\r\n        local = options.participant;\r\n\t},\r\n\r\n\tafterRender: function(){\r\n\t\t$(this.el).attr('id', this.options.participant.id);\r\n\t},\r\n\r\n\tgetRenderData: function(){\r\n        return {\r\n            id: this.options.participant.id,\r\n            title: this.options.participant.title\r\n        };\r\n    },\r\n\r\n    displayMessage: function(message) {\r\n    \tvar that = this;\r\n\r\n    \tthis.$('.participant-nickname').fadeOut(function() {\r\n  \t\t\t$(this).text(message).fadeIn();\r\n\t\t});\r\n\r\n    \t//this.$('.me-nickname').text(message);\r\n    \tthis.$('.participant-nickname').attr('title', message);\r\n\r\n    \tclearTimeout(timeoutID);\r\n\r\n    \ttimeoutID = setTimeout(function() {\r\n\t\t\tthat.$('.participant-nickname').text(that.options.participant.title);\r\n    \t\tthat.$('.participant-nickname').attr('title', that.options.participant.title);    \t\t\r\n    \t}, 10000);\r\n    },\r\n\r\n    getLocal: function() {\r\n        return this.local;\r\n    }\r\n\r\n\r\n\r\n});\t\r\n","var View     = require('./view'),\r\n\tmedia\t = require('../lib/media'),\r\n    me       = require('../lib/me'),\r\n    Participant = require('./participant'),\r\n    Stage = require('./stage'),\r\n    Local = require('./local'),\r\n    IM = require('../models/im'),\r\n    Message = require('../models/message'),\r\n    MessageUI = require('./message');\r\n\r\nvar listOfParticipants = {};\r\n\r\nvar participantsCaps = {};\r\n\r\nvar participantOnStageID = null;\r\nvar participantOnStage = null;\r\nvar participantLocal = null;\r\n\r\nvar test_id = null;\r\n\r\nvar im = new IM();\r\n\r\nvar full = false;\r\n\r\nmodule.exports = View.extend({\r\n\tid: 'main-view',\r\n\r\n    className: 'main-view',\r\n\r\n\ttemplate: require('./templates/main'),\r\n\r\n\tevents: {\r\n        'click .inviteButton': 'onInvitation' \r\n\t},\r\n\r\n\tsubscriptions: {\r\n        'media:participantConnected': 'onParticipantConnected',\r\n        'media:participantAlreadyConnected': 'onParticipantAlreadyConnected',\r\n        'media:participantDisconnected': 'onRemoteVideoEnded',\r\n        'media:onCallOffered': 'onCallOffered',\r\n        'media:remoteVideoON': 'onRemoteVideoReceived',\r\n        'media:localStreamStarted': 'onLocalMediaStarted',\r\n    },\r\n\r\n\tinitialize: function() {\r\n        this.listenTo(me.getConference(), 'change:title', this.onConferenceTitleChange);\r\n\t},\r\n\r\n\tafterRender: function(){\r\n        this.$('.participants').css('height', 'calc(100% - 45px)');\r\n        $('body').css('background-color', '#000');\r\n\r\n        media.acquireCamera(me.hasAudio(), me.hasVideo());\r\n        this.updateConferenceTitle();\r\n\t},\r\n\r\n\tgetRenderData: function(){\r\n    },\r\n\r\n    onParticipantConnected: function(id, caps) {\r\n\r\n        //Store participants capabilities\r\n        participantsCaps[id] = caps;\r\n\r\n        // Display this participant\r\n        this._addNewParticipantElement(id, caps.nickname);\r\n    },\r\n\r\n    onParticipantAlreadyConnected: function (id, caps) {\r\n        // Store participants capabilities\r\n        participantsCaps[id] = caps;\r\n\r\n        // Display this participant\r\n    \tthis._addNewParticipantElement(id, caps.nickname);\r\n\r\n    \t// Call this participant\r\n    \tmedia.callParticipant(id, caps.mediaCaps.canShareData || false);\r\n    },\r\n\r\n    onParticipantDisconnected: function(id) {\r\n\r\n    },\r\n\r\n    _addExistingParticipantOnList: function(participant) {\r\n\r\n        listOfParticipants[participant.id] = new Participant({ participant: participant, media: media}).render();\r\n\r\n        this.$('#participants').append(listOfParticipants[participant.id].el);\r\n\r\n        listOfParticipants[participant.id].displayVideo();\r\n    },\r\n\r\n    _addNewParticipantElement: function(id, nickname, isLocal) {\r\n\r\n        var participant = {\r\n            id: id,\r\n            title: nickname,\r\n            //isLocal: isLocal || false\r\n        };\r\n\r\n        listOfParticipants[id] = new Participant({ participant: participant, media: media}).render();\r\n\r\n        this.$('#participants').append(listOfParticipants[id].el);\r\n\r\n        if(isLocal) {\r\n            listOfParticipants[id].displayLocalVideo();\r\n        }\r\n\r\n        this.updateWallAccordingToParticipantNumber();\r\n    },\r\n\r\n    onCallOffered: function(id) {\r\n    \tmedia.answerParticipant(id, participantsCaps[id].mediaCaps.canShareData || false);\r\n    },\r\n\r\n    updateWallAccordingToParticipantNumber: function() {\r\n\r\n        var list = this.$('.participant');\r\n\r\n        var width,\r\n            height;\r\n\r\n        var l = list.length;\r\n\r\n        if(l == 1) {\r\n            width = '100%';\r\n            height = '100%';\r\n        }\r\n        else if(l == 2) {\r\n            width = '50%';\r\n            height = '100%';\r\n        }\r\n        else if (l <= 4) {\r\n            width = '50%';\r\n            height = '50%';\r\n        }\r\n        else if (l <= 6) {\r\n            width = '33.33%';\r\n            height = '50%';\r\n        }\r\n        else if (l <= 9) {\r\n            width = '33.33%';\r\n            height = '33.33%';\r\n        }\r\n        else if (l <= 12) {\r\n            width = '25%';\r\n            height = '33.33%';\r\n        }\r\n        else if(l <= 16) {\r\n            width = '25%';\r\n            height = '25%';\r\n        }\r\n        else if(l <= 25) {\r\n            width = '20%';\r\n            height = '20%';\r\n        }\r\n\r\n        for (var i = 0;i < list.length; i++) {\r\n            list.css('width', width );\r\n            list.css('height', height);\r\n        }\r\n    },\r\n\r\n    onRemoteVideoReceived: function(id) {\r\n        listOfParticipants[id].displayVideo();\r\n    },\r\n\r\n    onRemoteVideoEnded: function(id) {\r\n\r\n        // Remove participant from the array of caps\r\n        participantsCaps[id] = null;\r\n        delete participantsCaps[id];\r\n\r\n        listOfParticipants[id].dispose();\r\n        listOfParticipants[id] = null;\r\n        delete listOfParticipants[id];\r\n\r\n        this.updateWallAccordingToParticipantNumber();        \r\n    },\r\n\r\n    onLocalMediaStarted: function(stream, id) {\r\n\r\n        var caps = {\r\n            nickname: me.nickname(),\r\n            audio: me.hasAudio(),\r\n            video: me.hasVideo(),\r\n            mediaCaps: media.getCapabilities()\r\n        };\r\n\r\n        this._addNewParticipantElement(id, caps.nickname, true);\r\n\r\n        media.connectToServer(caps, me.getConferenceCode());\r\n    },\r\n\r\n    onConferenceTitleChange: function(data) {\r\n        this.$('.title').text(me.getConferenceTitle() + ' (' + me.getConferenceCode() + ')');\r\n    },\r\n\r\n    updateConferenceTitle: function() {\r\n        this.$('.title').text(me.getConferenceTitle() + ' (' + me.getConferenceCode() + ')');\r\n    },\r\n\r\n    onInvitation: function() {\r\n\r\n        var title = \"Invitation to join the \" + me.getConferenceTitle() + \" conference\"\r\n\r\n        var body = \"Hi,\\n\\nYou are invited to join the following conference: \" + me.getConferenceTitle() + \"\\n\\n\" \r\n        + \"Click on the link to join it: \" \r\n        + document.location.origin + \"#join?room=\" + me.getConferenceCode() + \"\\n\\n\" \r\n        + \"Have fun,\\n\" \r\n        + \"Infinite Wall,\\nAlcatel-Lucent Enterprise\"; \r\n\r\n        var mailto_link = 'mailto:'+'?subject='+title+'&body='+escape(body);\r\n\r\n        window.location.href=mailto_link; \r\n    }\r\n\r\n});\t","var View     = require('./view');\r\n\r\nmodule.exports = View.extend({\r\n\r\n\ttagName: \"li\",\r\n\r\n    className: \"message\",\r\n\r\n\ttemplate: require('./templates/message'),\r\n\r\n\tevents: {\r\n\t},\r\n\r\n\tsubscriptions: {\r\n\r\n    },\r\n\r\n    initialize: function(options) {\r\n\t},\r\n\r\n\tafterRender: function(){\r\n\t},\r\n\r\n\tgetRenderData: function(){\r\n        return {\r\n            time: moment(this.model.get('time')).format(\"HH:mm\"),\r\n            issuer: this.model.get('issuer'),\r\n            content: this.model.get('content')\r\n        };\r\n    }\r\n\r\n\r\n});\t","var View     = require('./view');\r\n\r\nvar timeoutID = -1;\r\n\r\nmodule.exports = View.extend({\r\n\r\n\ttagName: \"div\",\r\n\r\n    participant: null,\r\n\r\n    media: null,\r\n\r\n    className: \"participant\",\r\n\r\n\ttemplate: require('./templates/participant'),\r\n\r\n\tevents: {\r\n\t},\r\n\r\n\tsubscriptions: {\r\n\r\n    },\r\n\r\n    initialize: function(options) {\r\n\t\tthis.media = options.media;\r\n        this.participant = options.participant;\r\n\t},\r\n\r\n\tafterRender: function(){\r\n       \r\n\t},\r\n\r\n\tgetRenderData: function(){\r\n        return {\r\n            id: this.participant.id,\r\n            title: this.participant.title\r\n        };\r\n    },\r\n\r\n    displayVideo: function() {\r\n        this.media.displayParticipantVideo(this.$('.participant-video')[0], this.participant.id);\r\n    },\r\n\r\n    displayLocalVideo: function() {\r\n        this.media.renderLocalStream(this.$('.participant-video')[0]);\r\n    }\r\n\r\n});\t\r\n","var View     = require('./view');\r\n\r\nvar media = null;\r\n\r\nmodule.exports = View.extend({\r\n\r\n    tagName: 'span',\r\n\r\n\ttemplate: require('./templates/stage'),\r\n\r\n    stage: null,\r\n\r\n\tevents: {\r\n\t},\r\n\r\n\tsubscriptions: {\r\n\r\n    },\r\n\r\n    initialize: function(options) {\r\n\t\tmedia = options.media;\r\n        this.stage = options.stage;\r\n\t},\r\n\r\n\tafterRender: function(){\r\n\t},\r\n\r\n\tgetRenderData: function(){\r\n        return {\r\n            id: this.options.stage.id,\r\n            title: this.options.stage.title\r\n        };\r\n    },\r\n\r\n    displayVideo: function() {\r\n    \tmedia.displayParticipantVideo(this.$('.stage-video')[0], this.stage.id);\r\n    },\r\n\r\n    stopVideo: function() {\r\n    \tthis.$('.stage-video')[0].src = '';\r\n    },\r\n\r\n    switchParticipant: function(participant) {\r\n        this.stage = participant;\r\n        this.updateTitle();\r\n        this.displayVideo();\r\n    },\r\n\r\n    updateTitle: function() {\r\n    \tthis.$('.stage-title').text(this.stage.title);\r\n    },\r\n\r\n    getStage: function() {\r\n        return this.stage;\r\n    }\r\n\r\n});\t\r\n","var __templateData = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"container\\\">\\n\\n    <span class=\\\"alcatel-logo\\\"></span>\\n\\n\t<div class=\\\"form-signin\\\">\\n\\n\t\t<form class=\\\"form-horizontal\\\" id=\\\"login-form\\\">\\n\t\t\t<h2>Infinite Wall</h2>\\n\t\t\t<p>Face-2-Face Video Conference</p>\\n\t\t\t<br><br>\\n\t\t\t<div class=\\\"control-group\\\">\\n\t\t    \t\\n\\n\t\t    \t<!-- Left part: image -->\\n\t\t\t\t<span class=\\\"login-user-avatar\\\" id=\\\"login-user-avatar-id\\\">\\n                \t<span class=\\\"login-user-avatar-image\\\" src=\\\"\\\" height=\\\"148\\\" width=\\\"148\\\" style=\\\"margin-left: 0px; margin-top: 0px;\\\"></span>\\n\\n        \t\t</span>\\n\\n        \t\t<!-- Right part: User settings -->\\n        \t\t<span class=\\\"info-user\\\">\\n    \t\t\t\t<label for=\\\"exampleInputEmail1\\\">Choose a nickname</label>\\n        \t\t\t<input type=\\\"text\\\" id=\\\"inputNickname\\\" placeholder=\\\"Enter a nickname\\\" class=\\\"form-control input-sm\\\" />\\n\t\t\t\t\t<br><br>\\n        \t\t\t<label for=\\\"exampleInputEmail1\\\">Select the media to use</label>\\n        \t\t\t<div class=\\\"btn-group filterCapability space\\\">\\n\t\t            \t<i class=\\\"dropdown-arrow dropdown-arrow-inverse\\\"></i>\\n\t\t           \t \t<button class=\\\"btn btn-primary btn-small filterLabel selectedCapability\\\" data-capabilities=\\\"full\\\">Audio + Video</button>\\n\t\t           \t \t<button class=\\\"btn btn-primary btn-small dropdown-toggle clearfix\\\" data-toggle=\\\"dropdown\\\">\\n\t\t                \t<span class=\\\"caret\\\"></span>\\n\t\t            \t</button>\\n\t\t            \t<ul class=\\\"dropdown-menu dropdown-inverse\\\">\\n\t\t                \t<li class=\\\"l-full selected\\\"><a href=\\\"\\\" data-capabilities=\\\"full\\\" data-text=\\\"Audio + Video\\\" class=\\\"full capabilitySelector\\\">Audio + Video</a></li>\\n\t\t                \t<li class=\\\"l-video\\\"><a href=\\\"\\\" data-capabilities=\\\"video\\\" data-text=\\\"Video Only\\\" class=\\\"video capabilitySelector\\\">Video Only</a></li>\\n\t\t            \t</ul>\\n\t\t        \t</div>\\n        \t\t</span>\\n\\n        \t\t<br><br><hr><br>\\n\\n        \t\t<!-- Bottom left part: Create a new conference -->\\n        \t\t<!-- Right part: User settings -->\\n        \t\t<span class=\\\"new-conference\\\">\\n        \t\t\t<label for=\\\"exampleInputEmail1\\\">Choose a conference title</label>\\n        \t\t\t<input type=\\\"text\\\" id=\\\"inputTitle\\\" placeholder=\\\"Enter a title\\\" class=\\\"form-control input-sm conferenceInput\\\" />\\n        \t\t\t<br><br>\\n        \t\t\t<button class=\\\"btn btn-info conferenceButtonCreate\\\" type=\\\"action\\\" id=\\\"joinNewButton\\\" disabled>Create</button>\\n        \t\t</span>\\n\\n        \t\t<span class=\\\"existing-conference\\\">\\n        \t\t\t<label for=\\\"exampleInputEmail1\\\">Join an existing conference</label>\\n        \t\t\t<input type=\\\"text\\\" id=\\\"inputCode\\\" placeholder=\\\"Enter an access code\\\" class=\\\"form-control input-sm conferenceInput\\\" />\\n        \t\t\t<br><br>\\n        \t\t\t<button class=\\\"btn btn-inverse conferenceButtonCreate\\\" type=\\\"action\\\" id=\\\"joinExistingButton\\\" disabled>Join</button>\\n        \t\t</span>\\n            \\n\t\t</form>\\n    \t\\n\t</div>\\n\\n</div>\";\n  });\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<video id=\\\"\";\n  if (stack1 = helpers.id) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.id; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"-video\\\" class=\\\"participant-video\\\" autoplay=\\\"true\\\"></video>\\r\\n<div class=\\\"participant-nickname\\\" title=\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \">\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\";\n  return buffer;\n  });\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  \n\n\n  return \"<div class=\\\"wrapper\\\">\\r\\n\t<div id=\\\"participants\\\" class=\\\"participants\\\"></div>\\r\\n\t<div class=\\\"header\\\">\\r\\n\t\t<span class=\\\"title\\\">Conference</span>\\r\\n\t\t<span class=\\\"inviteButton touchButton unselectedTab\\\">Invite a participant</span>\\r\\n\t</div>\\r\\n\\r\\n\t\\r\\n</div>\\r\\n\\r\\n\";\n  });\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"message-issuer\\\">\";\n  if (stack1 = helpers.issuer) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.issuer; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\r\\n<div class=\\\"message-time\\\">\";\n  if (stack1 = helpers.time) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.time; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\r\\n<div class=\\\"message-content\\\">\";\n  if (stack1 = helpers.content) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.content; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\r\\n<div class=\\\"clear\\\"></div>\\r\\n\";\n  return buffer;\n  });\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"\\r\\n<video class=\\\"participant-video\\\" autoplay=\\\"true\\\">\\r\\n\t<source class=\\\"participant-source\\\">\\r\\n</video>\\r\\n<div class=\\\"participant-nickname\\\" title=\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \">\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\r\\n\";\n  return buffer;\n  });\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<video class=\\\"stage-video\\\" autoplay=\\\"true\\\"></video>\\r\\n<div class=\\\"stage-title\\\" title=\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \">\";\n  if (stack1 = helpers.title) { stack1 = stack1.call(depth0, {hash:{},data:data}); }\n  else { stack1 = depth0.title; stack1 = typeof stack1 === functionType ? stack1.apply(depth0) : stack1; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\";\n  return buffer;\n  });\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","require('lib/view_helper')\n\n// Base class for all views\nmodule.exports = Backbone.View.extend({\n    \n    initialize: function(){\n        this.render = _.bind(this.render, this)\n    },\n    \n    template: function(){},\n    getRenderData: function(){},\n    \n    render: function(){\n        this.$el.html(this.template(this.getRenderData()))\n        this.afterRender()\n        return this\n    },\n    \n    afterRender: function(){},\n\n    dispose: function(){\n        this.remove();\n        this.unbind();\n    }\n    \n})\n"]}